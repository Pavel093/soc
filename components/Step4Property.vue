<template>
  <div class="property-step">
    <h2 class="step-title dark-text">4. –ò–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è</h2>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ -->
    <div class="info-block">
      <p class="info-text">
        ‚ÑπÔ∏è –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å–æ–±–∏—è —Å–µ–º—å—è –¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º. 
        –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤—Å—ë –∏–º—É—â–µ—Å—Ç–≤–æ —á–ª–µ–Ω–æ–≤ —Å–µ–º—å–∏.
      </p>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 1: –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å -->
    <div class="section">
      <h3 class="section-title">üè† –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</h3>
      
      <!-- –ñ–∏–ª—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è -->
      <div class="property-item">
        <h4>–ö–≤–∞—Ä—Ç–∏—Ä—ã –∏ –¥–æ–º–∞</h4>
        
        <div class="input-group">
          <label class="field-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–ª—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π (–∫–≤–∞—Ä—Ç–∏—Ä, –¥–æ–º–æ–≤):</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" v-model.number="homes" :value="0" />
              <span class="radio-custom"></span>
              <span class="radio-text">–ù–µ—Ç –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</span>
            </label>
            <label class="radio-label">
              <input type="radio" v-model.number="homes" :value="1" />
              <span class="radio-custom"></span>
              <span class="radio-text">1 –ø–æ–º–µ—â–µ–Ω–∏–µ</span>
            </label>
            <label class="radio-label">
              <input type="radio" v-model.number="homes" :value="2" />
              <span class="radio-custom"></span>
              <span class="radio-text">2 –∏ –±–æ–ª–µ–µ</span>
            </label>
          </div>
        </div>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–æ—â–∞–¥–∏ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
        <div v-if="homes > 1" class="area-check">
          <div class="warning-box">
            <p>‚ö†Ô∏è –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∂–∏–ª—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å</p>
          </div>
          
          <div class="input-group">
            <label class="field-label">–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –≤—Å–µ—Ö –∂–∏–ª—ã—Ö –ø–æ–º–µ—â–µ–Ω–∏–π (–º¬≤):</label>
            <input 
              type="number" 
              v-model.number="totalHomeArea"
              min="0"
              class="number-input"
              placeholder="0"
            />
          </div>
          
          <div class="calculation-info">
            <p>–†–∞–∑–º–µ—Ä —Å–µ–º—å–∏: <strong>{{ store.familySize }} —á–µ–ª.</strong></p>
            <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–∞—è –ø–ª–æ—â–∞–¥—å: <strong>{{ maxAllowedArea }} –º¬≤</strong> (24 –º¬≤ –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞)</p>
            <p class="status" :class="homeAreaOk ? 'status-ok' : 'status-error'">
              {{ homeAreaOk ? '‚úì –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º' : '‚úó –ü—Ä–µ–≤—ã—à–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—É—é –Ω–æ—Ä–º—É' }}
            </p>
          </div>
        </div>

        <!-- –ò—Å–∫–ª—é—á–µ–Ω–∏—è -->
        <div v-if="homes > 0" class="exceptions">
          <label class="custom-checkbox">
            <input type="checkbox" v-model="homeExceptions.uninhabitable" />
            <span class="checkmark"></span>
            <span class="checkbox-text">–û–¥–Ω–æ –∏–∑ –ø–æ–º–µ—â–µ–Ω–∏–π –ø—Ä–∏–∑–Ω–∞–Ω–æ –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω—ã–º –¥–ª—è –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</span>
          </label>
          <label class="custom-checkbox">
            <input type="checkbox" v-model="homeExceptions.familyMemberIll" />
            <span class="checkmark"></span>
            <span class="checkbox-text">–ß–ª–µ–Ω —Å–µ–º—å–∏ —Å—Ç—Ä–∞–¥–∞–µ—Ç —Ç—è–∂–µ–ª–æ–π —Ñ–æ—Ä–º–æ–π —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è</span>
          </label>
          <label class="custom-checkbox">
            <input type="checkbox" v-model="homeExceptions.moreThree" />
            <span class="checkmark"></span>
            <span class="checkbox-text">–ü–æ–º–µ—â–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –º–Ω–æ–≥–æ–¥–µ—Ç–Ω–æ–π —Å–µ–º—å–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –º–µ—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏</span>
          </label>
        </div>
      </div>

      <!-- –î–∞—á–∏ -->
      <div class="property-item">
        <h4>–î–∞—á–∏ –∏ —Å–∞–¥–æ–≤—ã–µ –¥–æ–º–∞</h4>
        <div class="input-group">
          <label class="custom-checkbox">
            <input type="checkbox" v-model="hasDacha" />
            <span class="checkmark"></span>
            <span class="checkbox-text">–ï—Å—Ç—å –¥–∞—á–∞ –∏–ª–∏ —Å–∞–¥–æ–≤—ã–π –¥–æ–º</span>
          </label>
        </div>
        <div v-if="hasDacha" class="sub-options">
          <label class="field-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞—á:</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" v-model.number="dachaCount" :value="1" />
              <span class="radio-custom"></span>
              <span class="radio-text">1 –¥–∞—á–∞</span>
            </label>
            <label class="radio-label">
              <input type="radio" v-model.number="dachaCount" :value="2" />
              <span class="radio-custom"></span>
              <span class="radio-text">2 –∏ –±–æ–ª–µ–µ</span>
            </label>
          </div>
          <p v-if="dachaCount > 1" class="error-text">
            ‚ùå –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ 1 –¥–∞—á–∏ –Ω–∞ —Å–µ–º—å—é
          </p>
        </div>
      </div>

      <!-- –ì–∞—Ä–∞–∂–∏ -->
      <div class="property-item">
        <h4>–ì–∞—Ä–∞–∂–∏ –∏ –º–∞—à–∏–Ω–æ–º–µ—Å—Ç–∞</h4>
        <div class="input-group">
          <label class="custom-checkbox">
            <input type="checkbox" v-model="hasGarage" />
            <span class="checkmark"></span>
            <span class="checkbox-text">–ï—Å—Ç—å –≥–∞—Ä–∞–∂ –∏–ª–∏ –º–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ</span>
          </label>
        </div>
        <div v-if="hasGarage" class="sub-options">
          <label class="field-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞—Ä–∞–∂–µ–π/–º–∞—à–∏–Ω–æ–º–µ—Å—Ç:</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" v-model.number="garageCount" :value="1" />
              <span class="radio-custom"></span>
              <span class="radio-text">1</span>
            </label>
            <label class="radio-label">
              <input type="radio" v-model.number="garageCount" :value="2" />
              <span class="radio-custom"></span>
              <span class="radio-text">2 (–¥–ª—è —Å–µ–º–µ–π —Å –∏–Ω–≤–∞–ª–∏–¥–æ–º)</span>
            </label>
            <label class="radio-label">
              <input type="radio" v-model.number="garageCount" :value="3" />
              <span class="radio-custom"></span>
              <span class="radio-text">3 –∏ –±–æ–ª–µ–µ</span>
            </label>
          </div>
          
          <div v-if="garageCount > 1" class="additional-check">
            <label class="custom-checkbox">
              <input type="checkbox" v-model="hasDisabledPerson" />
              <span class="checkmark"></span>
              <span class="checkbox-text">–í —Å–µ–º—å–µ –µ—Å—Ç—å –∏–Ω–≤–∞–ª–∏–¥</span>
            </label>
            <p v-if="garageCount > 2 || (garageCount > 1 && !hasDisabledPerson)" class="error-text">
              ‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–∞—Ä–∞–∂–µ–π
            </p>
          </div>
        </div>
      </div>

      <!-- –ù–µ–∂–∏–ª—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è -->
      <div class="property-item">
        <h4>–ù–µ–∂–∏–ª—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è</h4>
        <div class="input-group">
          <label class="custom-checkbox">
            <input type="checkbox" v-model="hasNonResidential" />
            <span class="checkmark"></span>
            <span class="checkbox-text">–ï—Å—Ç—å –Ω–µ–∂–∏–ª—ã–µ –ø–æ–º–µ—â–µ–Ω–∏—è</span>
          </label>
        </div>
        <div v-if="hasNonResidential" class="info-box">
          <p>‚ÑπÔ∏è –•–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –∑–µ–º–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–∫–∞—Ö (—Å–∞—Ä–∞–∏, –±–∞–Ω–∏ –∏ —Ç.–¥.) –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è</p>
        </div>
      </div>

      <!-- –ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏ -->
      <div class="property-item">
        <h4>–ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏</h4>
        <div class="input-group">
          <label class="custom-checkbox">
            <input type="checkbox" v-model="hasLand" />
            <span class="checkmark"></span>
            <span class="checkbox-text">–ï—Å—Ç—å –∑–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏</span>
          </label>
        </div>
        <div v-if="hasLand" class="sub-options">
          <div class="input-group">
            <label class="field-label">–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –∑–µ–º–µ–ª—å–Ω—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤ (—Å–æ—Ç–æ–∫):</label>
            <input 
              type="number" 
              v-model.number="landArea"
              min="0"
              class="number-input"
              placeholder="0"
            />
          </div>
          <div class="calculation-info">
            <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–∞—è –ø–ª–æ—â–∞–¥—å:</p>
            <ul>
              <li>–í –≥–æ—Ä–æ–¥–µ: <strong>25 —Å–æ—Ç–æ–∫</strong></li>
              <li>–í —Å–µ–ª—å—Å–∫–æ–π –º–µ—Å—Ç–Ω–æ—Å—Ç–∏: <strong>100 —Å–æ—Ç–æ–∫</strong></li>
            </ul>
            <label class="custom-checkbox">
              <input type="checkbox" v-model="isRuralArea" />
              <span class="checkmark"></span>
              <span class="checkbox-text">–£—á–∞—Å—Ç–æ–∫ –≤ —Å–µ–ª—å—Å–∫–æ–π –º–µ—Å—Ç–Ω–æ—Å—Ç–∏</span>
            </label>
            <p class="status" :class="landAreaOk ? 'status-ok' : 'status-error'">
              {{ landAreaOk ? '‚úì –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º' : '‚úó –ü—Ä–µ–≤—ã—à–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—É—é –Ω–æ—Ä–º—É' }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 2: –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ -->
    <div class="section">
      <h3 class="section-title">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞</h3>
      
      <!-- –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ -->
      <div class="property-item">
        <h4>–ê–≤—Ç–æ–º–æ–±–∏–ª–∏</h4>
        
        <div class="input-group">
          <label class="field-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –≤ —Å–µ–º—å–µ:</label>
          <div class="counter-group">
            <button @click="decrementCars" :disabled="cars <= 0" class="counter-btn">-</button>
            <input 
              type="number" 
              v-model.number="cars"
              min="0"
              max="10"
              class="counter-input"
              @input="validateCarInput"
            />
            <button @click="incrementCars" :disabled="cars >= 10" class="counter-btn">+</button>
          </div>
        </div>

        <div class="calculation-info" v-if="store.childrenCount >= 0">
          <p>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–π –≤ —Å–µ–º—å–µ: <strong>{{ store.childrenCount }}</strong></p>
          <p>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π: <strong>{{ maxCars }}</strong></p>
          <p class="status" :class="carsOk ? 'status-ok' : 'status-error'">
            {{ carsOk ? '‚úì –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º' : '‚úó –ü—Ä–µ–≤—ã—à–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ' }}
          </p>
        </div>

        <!-- –î–µ—Ç–∞–ª–∏ –ø–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º -->
        <div v-if="cars > 0" class="car-details">
          <h5>–£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:</h5>
          
          <div v-for="i in cars" :key="i" class="car-item">
            <h6>–ê–≤—Ç–æ–º–æ–±–∏–ª—å {{ i }}</h6>
            
            <div class="input-group">
              <label class="field-label">–ú–æ—â–Ω–æ—Å—Ç—å –¥–≤–∏–≥–∞—Ç–µ–ª—è (–ª.—Å.):</label>
              <input 
                type="number" 
                v-model.number="carDetails[i-1].power"
                min="0"
                class="number-input"
                placeholder="0"
              />
            </div>
            
            <div class="input-group">
              <label class="field-label">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞:</label>
              <input 
                type="number" 
                v-model.number="carDetails[i-1].year"
                min="1900"
                :max="currentYear"
                class="number-input"
                placeholder="2020"
              />
            </div>
            
            <div class="car-status">
              <p v-if="carDetails[i-1].power > 250" class="warning-text">
                ‚ö†Ô∏è –ú–æ—â–Ω–æ—Å—Ç—å –±–æ–ª–µ–µ 250 –ª.—Å.
              </p>
              <p v-if="currentYear - carDetails[i-1].year < 5" class="warning-text">
                ‚ö†Ô∏è –í–æ–∑—Ä–∞—Å—Ç –º–µ–Ω–µ–µ 5 –ª–µ—Ç
              </p>
              <p v-if="carDetails[i-1].power > 250 && currentYear - carDetails[i-1].year < 5" class="error-text">
                ‚ùå –ê–≤—Ç–æ–º–æ–±–∏–ª—å –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º (–º–æ—â–Ω–æ—Å—Ç—å > 250 –ª.—Å. –ò –≤–æ–∑—Ä–∞—Å—Ç < 5 –ª–µ—Ç)
              </p>
            </div>
            
            <label class="custom-checkbox">
              <input type="checkbox" v-model="carDetails[i-1].isSpecial" />
              <span class="checkmark"></span>
              <span class="checkbox-text">–ê–≤—Ç–æ–º–æ–±–∏–ª—å –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞ (–ø–æ–ª—É—á–µ–Ω —á–µ—Ä–µ–∑ —Å–æ—Ü–∑–∞—â–∏—Ç—É)</span>
            </label>
            
            <label class="custom-checkbox">
              <input type="checkbox" v-model="carDetails[i-1].isTaxi" />
              <span class="checkmark"></span>
              <span class="checkbox-text">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ç–∞–∫—Å–∏ (–µ—Å—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—è)</span>
            </label>
          </div>
        </div>
      </div>

      <!-- –ú–æ—Ç–æ—Ü–∏–∫–ª—ã -->
      <div class="property-item">
        <h4>–ú–æ—Ç–æ—Ü–∏–∫–ª—ã –∏ –º–æ—Ç–æ—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h4>
        
        <div class="input-group">
          <label class="field-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ—Ç–æ—Ü–∏–∫–ª–æ–≤:</label>
          <div class="counter-group">
            <button @click="motorcycles = Math.max(0, motorcycles - 1)" 
                    :disabled="motorcycles <= 0" class="counter-btn">-</button>
            <input 
              type="number" 
              v-model.number="motorcycles"
              min="0"
              max="10"
              class="counter-input"
            />
            <button @click="motorcycles++" 
                    :disabled="motorcycles >= 10" class="counter-btn">+</button>
          </div>
        </div>
        
        <p v-if="motorcycles > 1" class="error-text">
          ‚ùå –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ 1 –º–æ—Ç–æ—Ü–∏–∫–ª–∞ –Ω–∞ —Å–µ–º—å—é
        </p>
      </div>

      <!-- –°–∞–º–æ—Ö–æ–¥–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ -->
      <div class="property-item">
        <h4>–°–∞–º–æ—Ö–æ–¥–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</h4>
        
        <label class="custom-checkbox">
          <input type="checkbox" v-model="hasTractor" />
          <span class="checkmark"></span>
          <span class="checkbox-text">–ï—Å—Ç—å —Ç—Ä–∞–∫—Ç–æ—Ä, –∫–æ–º–±–∞–π–Ω –∏–ª–∏ –¥—Ä—É–≥–∞—è —Å–∞–º–æ—Ö–æ–¥–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞</span>
        </label>
        
        <div v-if="hasTractor" class="sub-options">
          <div class="input-group">
            <label class="field-label">–í–æ–∑—Ä–∞—Å—Ç —Ç–µ—Ö–Ω–∏–∫–∏ (–ª–µ—Ç):</label>
            <input 
              type="number" 
              v-model.number="tractorAge"
              min="0"
              class="number-input"
              placeholder="0"
            />
          </div>
          <p v-if="tractorAge < 5" class="error-text">
            ‚ùå –°–∞–º–æ—Ö–æ–¥–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –º–ª–∞–¥—à–µ 5 –ª–µ—Ç –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
          </p>
        </div>
      </div>

      <!-- –í–æ–¥–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç -->
      <div class="property-item">
        <h4>–í–æ–¥–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h4>
        
        <label class="custom-checkbox">
          <input type="checkbox" v-model="hasBoat" />
          <span class="checkmark"></span>
          <span class="checkbox-text">–ï—Å—Ç—å –∫–∞—Ç–µ—Ä, –º–æ—Ç–æ—Ä–Ω–∞—è –ª–æ–¥–∫–∞ –∏–ª–∏ –¥—Ä—É–≥–æ–π –≤–æ–¥–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</span>
        </label>
        
        <div v-if="hasBoat" class="sub-options">
          <div class="input-group">
            <label class="field-label">–í–æ–∑—Ä–∞—Å—Ç –≤–æ–¥–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (–ª–µ—Ç):</label>
            <input 
              type="number" 
              v-model.number="boatAge"
              min="0"
              class="number-input"
              placeholder="0"
            />
          </div>
          <p v-if="boatAge < 5" class="error-text">
            ‚ùå –í–æ–¥–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –º–ª–∞–¥—à–µ 5 –ª–µ—Ç –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
          </p>
        </div>
      </div>
    </div>

    <!-- –†–∞–∑–¥–µ–ª 3: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∞–∫—Ç–∏–≤—ã -->
    <div class="section">
      <h3 class="section-title">üí∞ –°–±–µ—Ä–µ–∂–µ–Ω–∏—è</h3>
      
      <div class="property-item">
        <div class="input-group">
          <label class="field-label">
            –ï—Å—Ç—å –ª–∏ –≤–∫–ª–∞–¥—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –¥–æ—Ö–æ–¥ –±–æ–ª–µ–µ 
            {{ (store.pmValue * 12).toLocaleString('ru-RU') }} —Ä—É–±. –≤ –≥–æ–¥?
          </label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" v-model="hasLargeDeposits" :value="false" />
              <span class="radio-custom"></span>
              <span class="radio-text">–ù–µ—Ç</span>
            </label>
            <label class="radio-label">
              <input type="radio" v-model="hasLargeDeposits" :value="true" />
              <span class="radio-custom"></span>
              <span class="radio-text">–î–∞</span>
            </label>
          </div>
        </div>
        
        <div v-if="hasLargeDeposits" class="warning-box">
          <p>‚ö†Ô∏è –ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –≤–∫–ª–∞–¥–∞–º —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ –¥–æ—Ö–æ–¥–∞—Ö —Å–µ–º—å–∏</p>
        </div>
      </div>
    </div>

    <!-- –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ -->
    <div class="summary-box">
      <h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π:</h4>
      <div class="check-list">
        <div class="check-item" :class="homeRequirementsMet ? 'check-ok' : 'check-error'">
          <span class="check-icon">{{ homeRequirementsMet ? '‚úì' : '‚úó' }}</span>
          <span>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</span>
        </div>
        <div class="check-item" :class="carRequirementsMet ? 'check-ok' : 'check-error'">
          <span class="check-icon">{{ carRequirementsMet ? '‚úì' : '‚úó' }}</span>
          <span>–ê–≤—Ç–æ–º–æ–±–∏–ª–∏</span>
        </div>
        <div class="check-item" :class="otherTransportMet ? 'check-ok' : 'check-error'">
          <span class="check-icon">{{ otherTransportMet ? '‚úì' : '‚úó' }}</span>
          <span>–î—Ä—É–≥–æ–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</span>
        </div>
        <div class="check-item" :class="landRequirementsMet ? 'check-ok' : 'check-error'">
          <span class="check-icon">{{ landRequirementsMet ? '‚úì' : '‚úó' }}</span>
          <span>–ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏</span>
        </div>
      </div>
      
      <div class="overall-status" :class="allRequirementsMet ? 'status-success' : 'status-error'">
        {{ allRequirementsMet ? '‚úÖ –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–æ–±–ª—é–¥–µ–Ω—ã' : '‚ùå –ò–º—É—â–µ—Å—Ç–≤–æ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º' }}
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch, reactive } from 'vue'
import { useCalculatorStore } from '../stores/calculatorStore'

const store = useCalculatorStore()
const currentYear = new Date().getFullYear()

// –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
const homes = ref(1)
const totalHomeArea = ref(0)
const homeExceptions = reactive({
  uninhabitable: false,
  familyMemberIll: false,
  moreThree: false
})
const hasDacha = ref(false)
const dachaCount = ref(1)
const hasGarage = ref(false)
const garageCount = ref(1)
const hasDisabledPerson = ref(false)
const hasNonResidential = ref(false)
const hasLand = ref(false)
const landArea = ref(0)
const isRuralArea = ref(false)

// –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
const cars = ref(0)
const carDetails = ref([])
const motorcycles = ref(0)
const hasTractor = ref(false)
const tractorAge = ref(0)
const hasBoat = ref(false)
const boatAge = ref(0)

// –§–∏–Ω–∞–Ω—Å—ã
const hasLargeDeposits = ref(false)

// –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
const maxCars = computed(() => store.childrenCount >= 3 ? 2 : 1)
const maxAllowedArea = computed(() => store.familySize * 24)
const homeAreaOk = computed(() => {
  if (homes.value <= 1) return true
  if (Object.values(homeExceptions).some(v => v)) return true
  return totalHomeArea.value <= maxAllowedArea.value
})

const landAreaOk = computed(() => {
  if (!hasLand.value) return true
  const maxArea = isRuralArea.value ? 100 : 25
  return landArea.value <= maxArea
})

const carsOk = computed(() => {
  if (cars.value <= maxCars.value) return true
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–∏–Ω–≤–∞–ª–∏–¥, —Ç–∞–∫—Å–∏)
  const specialCars = carDetails.value.filter(car => car.isSpecial || car.isTaxi).length
  return (cars.value - specialCars) <= maxCars.value
})

const carRequirementsMet = computed(() => {
  if (!carsOk.value) return false
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å
  for (const car of carDetails.value) {
    if (!car.isSpecial && !car.isTaxi) {
      if (car.power > 250 && currentYear - car.year < 5) {
        return false
      }
    }
  }
  return true
})

const homeRequirementsMet = computed(() => {
  if (!homeAreaOk.value) return false
  if (dachaCount.value > 1) return false
  if (garageCount.value > 2) return false
  if (garageCount.value > 1 && !hasDisabledPerson.value) return false
  return true
})

const otherTransportMet = computed(() => {
  if (motorcycles.value > 1) return false
  if (hasTractor.value && tractorAge.value < 5) return false
  if (hasBoat.value && boatAge.value < 5) return false
  return true
})

const landRequirementsMet = computed(() => landAreaOk.value)

const allRequirementsMet = computed(() => {
  return homeRequirementsMet.value && 
         carRequirementsMet.value && 
         otherTransportMet.value && 
         landRequirementsMet.value
})

// –ú–µ—Ç–æ–¥—ã
const incrementCars = () => {
  if (cars.value < 10) {
    cars.value++
    ensureCarDetails()
  }
}

const decrementCars = () => {
  if (cars.value > 0) {
    cars.value--
    carDetails.value = carDetails.value.slice(0, cars.value)
  }
}

const validateCarInput = () => {
  if (cars.value < 0) cars.value = 0
  if (cars.value > 10) cars.value = 10
  ensureCarDetails()
}

const ensureCarDetails = () => {
  while (carDetails.value.length < cars.value) {
    carDetails.value.push({
      power: 0,
      year: currentYear - 6,
      isSpecial: false,
      isTaxi: false
    })
  }
}

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
watch([homes, homeAreaOk], () => {
  store.property.homes = homes.value
  store.property.homeAreaOk = homeAreaOk.value
})

watch([cars, carRequirementsMet], () => {
  store.property.cars = cars.value
  store.property.carSpecOk = carRequirementsMet.value
})

watch(motorcycles, (val) => {
  store.property.hasMotorcycle = val > 0
})

watch(hasBoat, (val) => {
  store.property.hasBoat = val
})

watch(hasGarage, (val) => {
  store.property.hasGarage = val
})

watch(hasDacha, (val) => {
  store.property.hasDacha = val
})

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
ensureCarDetails()
</script>

<style scoped>
.property-step {
  padding: 20px;
}

.step-title {
  margin-bottom: 20px;
  font-size: 20px;
}

.info-block {
  background: #e3f2fd;
  border-left: 4px solid #2196f3;
  padding: 15px;
  margin-bottom: 25px;
  border-radius: 4px;
}

.info-text {
  margin: 0;
  color: #1565c0;
  font-size: 14px;
}

.section {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

.section-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 20px;
  color: #495057;
}

.property-item {
  background: white;
  padding: 15px;
  border-radius: 6px;
  margin-bottom: 15px;
}

.property-item h4 {
  margin-top: 0;
  margin-bottom: 15px;
  color: #333;
  font-size: 16px;
}

.property-item h5 {
  margin-top: 15px;
  margin-bottom: 10px;
  color: #555;
  font-size: 14px;
}

.property-item h6 {
  margin-top: 10px;
  margin-bottom: 10px;
  color: #666;
  font-size: 13px;
  font-weight: 500;
}

.input-group {
  margin-bottom: 15px;
}

.field-label {
  display: block;
  margin-bottom: 8px;
  color: #666;
  font-size: 14px;
}

.number-input {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
}

.number-input:focus {
  outline: none;
  border-color: #2196f3;
}

.radio-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.radio-label {
  display: flex;
  align-items: center;
  cursor: pointer;
  padding: 10px;
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  transition: all 0.3s;
}

.radio-label:hover {
  background: #f5f5f5;
}

.radio-label input[type="radio"] {
  display: none;
}

.radio-custom {
  width: 20px;
  height: 20px;
  border: 2px solid #ddd;
  border-radius: 50%;
  margin-right: 10px;
  position: relative;
  transition: all 0.3s;
}

.radio-label input:checked ~ .radio-custom {
  border-color: #2196f3;
}

.radio-label input:checked ~ .radio-custom::after {
  content: '';
  width: 10px;
  height: 10px;
  background: #2196f3;
  border-radius: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

.radio-text {
  color: #495057;
  font-size: 14px;
}

.custom-checkbox {
  display: flex;
  align-items: center;
  cursor: pointer;
  margin-bottom: 10px;
  position: relative;
  padding-left: 30px;
}

.custom-checkbox input[type="checkbox"] {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

.checkmark {
  position: absolute;
  left: 0;
  top: 2px;
  height: 20px;
  width: 20px;
  background-color: white;
  border: 2px solid #ddd;
  border-radius: 4px;
  transition: all 0.3s;
}

.custom-checkbox input:checked ~ .checkmark {
  background-color: #2196f3;
  border-color: #2196f3;
}

.checkmark:after {
  content: "";
  position: absolute}
  </style>